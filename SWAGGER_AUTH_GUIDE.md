# –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ Swagger UI - AI Integration Service

## üîê –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

Swagger UI –≤ AI Integration Service –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **JWT Bearer Token** –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é. –í–æ—Ç –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è:

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç–µ JWT —Ç–æ–∫–µ–Ω

1. –û—Ç–∫—Ä–æ–π—Ç–µ Swagger UI: `http://localhost:8091/swagger-ui.html`

2. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é **"Authentication"** 

3. –û—Ç–∫—Ä–æ–π—Ç–µ endpoint **POST `/api/auth/login`**

4. –ù–∞–∂–º–∏—Ç–µ **"Try it out"**

5. –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞:
   ```json
   {
     "username": "admin",
     "password": "admin"
   }
   ```

6. –ù–∞–∂–º–∏—Ç–µ **"Execute"**

7. –í –æ—Ç–≤–µ—Ç–µ (Response body) —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ `token`:
   ```json
   {
     "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
     "username": "admin",
     "expiresAt": "2025-11-06T14:00:00"
   }
   ```

### –®–∞–≥ 2: –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ Swagger

1. –í –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É Swagger UI –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"Authorize"** üîì

2. –í –æ—Ç–∫—Ä—ã–≤—à–µ–º—Å—è –æ–∫–Ω–µ –Ω–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é **"Bearer (http, Bearer)"**

3. –í –ø–æ–ª–µ **"Value"** –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω:
   ```
   Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
   ```
   
   ‚ö†Ô∏è **–í–ê–ñ–ù–û**: –°–ª–æ–≤–æ `Bearer` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –Ω–∞—á–∞–ª–µ, –∑–∞—Ç–µ–º –ø—Ä–æ–±–µ–ª, –∑–∞—Ç–µ–º —Å–∞–º —Ç–æ–∫–µ–Ω!

4. –ù–∞–∂–º–∏—Ç–µ **"Authorize"**

5. –ó–∞–∫—Ä–æ–π—Ç–µ –æ–∫–Ω–æ

### –®–∞–≥ 3: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ endpoints

–¢–µ–ø–µ—Ä—å –≤—Å–µ `/api/admin/**` endpoints –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å! üéâ

–ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ:
- **GET `/api/admin/clients`** - –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤
- **POST `/api/admin/clients`** - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
- **GET `/api/admin/networks`** - –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π
- **POST `/api/admin/access/grant-all/{clientId}`** - –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Å–µ—Ç—è–º

## üîë –î–ª—è API endpoints –∫–ª–∏–µ–Ω—Ç–æ–≤

–î–ª—è `/api/ai/**` endpoints –Ω—É–∂–µ–Ω **X-API-Key**:

1. –ù–∞–∂–º–∏—Ç–µ **"Authorize"** üîì

2. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é **"X-API-Key (apiKey)"**

3. –í—Å—Ç–∞–≤—å—Ç–µ API –∫–ª—é—á –∫–ª–∏–µ–Ω—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, noteapp):
   ```
   aikey_1234567890abcdef...
   ```

4. –ù–∞–∂–º–∏—Ç–µ **"Authorize"**

## ‚ùå –ü–æ—á–µ–º—É –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–Ω–æ–ø–∫–∞ Authorize –Ω–∞–ø—Ä—è–º—É—é?

Swagger UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É "Authorize" —Å—Ä–∞–∑—É, –Ω–æ –æ–Ω–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Ç–æ–º—É —á—Ç–æ:
- –ù–∞—à API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **custom login endpoint** (`/api/auth/login`)
- Swagger –æ–∂–∏–¥–∞–µ—Ç **Basic Auth** –∏–ª–∏ **OAuth2**, –∞ —É –Ω–∞—Å JWT —Å custom endpoint
- –ü–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω–æ **—Å–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –≤—Ä—É—á–Ω—É—é**, –ø–æ—Ç–æ–º –≤—Å—Ç–∞–≤–∏—Ç—å –µ–≥–æ

## üêõ –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ–±–ª–µ–º–∞ 1: CORS –æ—à–∏–±–∫–∞

**–°–∏–º–ø—Ç–æ–º:** "Failed to fetch. Possible Reasons: CORS"

**–†–µ—à–µ–Ω–∏–µ:** 
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ SecurityConfig –æ–±–Ω–æ–≤–ª–µ–Ω (CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ AI Integration Service
3. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+Shift+Delete)

### –ü—Ä–æ–±–ª–µ–º–∞ 2: 401 Unauthorized

**–°–∏–º–ø—Ç–æ–º:** –í—Å–µ admin endpoints –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 401

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ç–æ–∫–µ–Ω –≤—Å—Ç–∞–≤–ª–µ–Ω –≤ —Ñ–æ—Ä–º–∞—Ç–µ: `Bearer YOUR_TOKEN`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ç–æ–∫–µ–Ω –Ω–µ –∏—Å—Ç–µ–∫ (—Å–º–æ—Ç—Ä–∏—Ç–µ `expiresAt` –≤ –æ—Ç–≤–µ—Ç–µ `/api/auth/login`)
3. –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ `/api/auth/login`

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Token expired

**–°–∏–º–ø—Ç–æ–º:** –ü–æ—Å–ª–µ –Ω–µ–∫–æ—Ç–æ—Ä–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ endpoints –ø–µ—Ä–µ—Å—Ç–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

**–†–µ—à–µ–Ω–∏–µ:**
1. JWT —Ç–æ–∫–µ–Ω—ã –∏—Å—Ç–µ–∫–∞—é—Ç —á–µ—Ä–µ–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è (–æ–±—ã—á–Ω–æ 24 —á–∞—Å–∞)
2. –ü—Ä–æ—Å—Ç–æ –ø–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ `/api/auth/login`
3. –û–±–Ω–æ–≤–∏—Ç–µ –≤ –∫–Ω–æ–ø–∫–µ "Authorize"

## üìù –ë—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± (—á–µ—Ä–µ–∑ curl)

–ï—Å–ª–∏ Swagger –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ curl:

```bash
# 1. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω
curl -X POST http://localhost:8091/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin"}'

# –û—Ç–≤–µ—Ç: {"token":"eyJhbGci...","username":"admin","expiresAt":"..."}

# 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–∫–µ–Ω –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
curl -X GET http://localhost:8091/api/admin/clients \
  -H "Authorization: Bearer eyJhbGci..."

# 3. –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞
curl -X POST http://localhost:8091/api/admin/clients \
  -H "Authorization: Bearer eyJhbGci..." \
  -H "Content-Type: application/json" \
  -d '{
    "name": "noteapp",
    "description": "Note application client"
  }'
```

## üéØ –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ noteapp —á–µ—Ä–µ–∑ Swagger

–ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:

1. –û—Ç–∫—Ä–æ–π—Ç–µ **POST `/api/admin/clients`**
2. –ù–∞–∂–º–∏—Ç–µ **"Try it out"**
3. –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ:
   ```json
   {
     "name": "noteapp",
     "description": "Note application for transcription"
   }
   ```
4. –ù–∞–∂–º–∏—Ç–µ **"Execute"**
5. –í –æ—Ç–≤–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç–µ:
   - `id` - UUID –∫–ª–∏–µ–Ω—Ç–∞ (–Ω—É–∂–µ–Ω –¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞)
   - `apiKey` - –∫–ª—é—á –¥–ª—è noteapp (–Ω—É–∂–Ω–æ –ø—Ä–æ–ø–∏—Å–∞—Ç—å –≤ –ë–î noteapp)

6. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `apiKey` –∏ –æ–±–Ω–æ–≤–∏—Ç–µ –≤ –ë–î noteapp:
   ```sql
   UPDATE ai_service_connections 
   SET api_key = '–°–ö–û–ü–ò–†–û–í–ê–ù–ù–´–ô_API_KEY'
   WHERE service_name = 'noteapp';
   ```

7. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –Ω–µ–π—Ä–æ—Å–µ—Ç—è–º:
   - –û—Ç–∫—Ä–æ–π—Ç–µ **POST `/api/admin/access/grant-all/{clientId}`**
   - –í `clientId` –≤—Å—Ç–∞–≤—å—Ç–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `id` –∫–ª–∏–µ–Ω—Ç–∞
   - –ù–∞–∂–º–∏—Ç–µ **"Execute"**

–ì–æ—Ç–æ–≤–æ! üéâ

---

**–ü—Ä–æ–±–ª–µ–º—ã?** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ AI Integration Service –≤ –∫–æ–Ω—Å–æ–ª–∏ –≥–¥–µ –æ–Ω –∑–∞–ø—É—â–µ–Ω.

